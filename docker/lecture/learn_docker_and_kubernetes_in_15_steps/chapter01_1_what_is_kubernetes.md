# chapter01 쿠버네티스란?
- 쿠버네티스는 컨테이너화된 애플리케이션을 효율적으로 배포하고 운영하기 위해 설계된 오픈 소스 플랫폼
- 컨테이너 기술은 CI/CD의 요구사항에 효과적인 대안을 제시
- 오픈 소스의 경우, 버전이 계속 바뀌는데, 이는 개발자간의 개발 환경 차이가 발생하여 개발 생산성과 안정성이 떨어짐
- 컨테이너 기술은 애플리케이션 실행에 필요한 라이브러리나 운영체제 패키지 등을 모두 담아 불변의 실행 환경을 만듬
- 특정 애플리케이션은 수십 명에서 수백만 명의 규모까지 대응 가능한 확장성과 가용성이 요구되는데, 이러한 요구를 쿠버네티스가 해결 가능하게 해줌

## 쿠버네티스의 개요
- 쿠버네티스는 다음과 같은 기능을 제공
  - 배포 계획에 맞춰 애플리케이션을 신속하게 배포할 수 있음  
    - 컨테이너 개수, CPU 사용률, 메모리 사용량
    - 저장 공간, 네트워크 접근 제어, 로드밸런싱 기능  
  - 가동 중인 애플리케이션을 스케일 업/다운할 수 있음
    - 요청이 많을 때는 컨테이너 수를 늘려 처리 능력을 높임
    - 요청이 적을 때는 컨테이너 수를 줄여 자원 점유율이나 요금을 줄임 
  - 새로운 버전의 애플리케이션을 무정지로 업그레이드 할 수 있음
  - 하드웨어 가동률을 높여 자원 낭비를 줄임  
  - 다양한 환경에서 쿠버네티스 사용 가능
    - 퍼블릭 클라우드
    - 프라이빗 클라우드
    - 멀티 클라우드
    - 하이브리드 클라우드
    - 온프레미스
  - 계속되는 변화를 전제로 설계된 높은 유연성과 확장성 
  - 고가용성과 성능 관리
 
## 탄생부터 현재까지의 역사
- 구글의 사내 운영 시스템인 Borg에서부터 출발

## 쿠버네티스가 해결하는 과제
### 애플리케이션의 빈번한 출시
- 쿠버네티스의 롤아웃과 롤백 기능은 새로운 기능을 수시로 출시하고 버그 수정을 긴급 투입하는 것과 같은 민감한 작업을 안전하게 자동화해줌
- 교체 중에 발생하는 성능 저하와 프로그램 충돌로 인한 서비스 정지를 막기 위해 컨테이너 교체 정책을 설정할 수 있음 


### 무정지 서비스
- 쿠버네티스의 자기 회복 기능은 무정지 서비스 운영을 도와줌
- 응답이 없어진 컨테이너를 재기동하며, 쿠버네티스 클러스터(K8s) 내에 지정한 수만큼 컨테이너가 돌도록 관리해줌
- 무정지 롤아웃이라는 쿠버네티스의 장점을 살리기 위해서는 애플리케이션 설계 단계부터 충분히 고려되어야 함  
예를 들어, DB 스키마가 변경된 경우는 롤백이 쉽지 않을 수 있음

### 초기 비용을 낮추고 비즈니스 상황에 맞게 규모를 조정
- 컨테이너 기술(docker)는 애플리케이션과 실행 환경을 하나로 묶어 배포할 수 있게 해줌
- 그리고 쿠버네티스는 복수의 노드 위에 컨테이너가 조화롭게 돌아갈 수 있도록 해줌
- 이 때 K8s 클러스터의 노드들이 똑같은 스팩일 필요가 없으며, 비즈니스 초기단계에서는 저렴한 서버를 사용하다가, 비즈니스 확대시 고성능으로 변경가능

### 쿠버네티스와 외부 서비스와의 연동
- DB의 컨테이너화는 신중할 필요성이 있는데, 컨테이너는 태생적으로 언제든지 재시작될 수 있는 일시적인 존재로 상태를 포함하지 않는 것을 전제로 하기 때문
- 이를 위해 쿠버네티슽는 외부 서비스를 내부 DNS에 등록하는 기능 제공

### 개발 환경과 운영 환경의 분리
- 운영환경에서 사용하는 엔드포인트나 인증 정보는 테스트 환경과 다름.  
  ex) HTTPS, 인증서
- 쿠버네티스에서는 클러스터를 여러 개의 가상환경으로 분할하는 것이 가능  
  그리고 각각의 가상환경에 설정 파일, 보안이 필요한 인증서 등을 저장 가능
- 이를 통해 테스트가 완료된 컨테이너의 이미지를 그대로 정식 운영 환경에 배포 가능

### 온프레미스나 클라우드 위에 구축
- 대형 클라우드 업체들은 EKS(AWS), AKS(Azure), IKS(IBM Cloud) 등을 제공

### 애플리케이션 중심의 오케스트레이션
- 쿠버네티스는 애플리케이션 중심의 운영이라는 흐름을 더욱 가속화 하는데, 애플리케이션 개발자가 YAML 파일을 기술하여 쿠버네티스에 제출하면 로드벨런서, 저장소, 네트워크, 런타임 등의 환경이 구성됨

### 특정 기업에 종속되지 않은 표준 기술
- 특정 회사의 종속되지 않는 표준 기술로 자리잡음

### 서버들의 가동률 높이기
- 가동률이 적은 서버의 애플리케이션을 한곳에 모을 수 있음. 그래서 서버의 CPU 가동률을 높게 유지하면서도 안정적으로 서비스 제공 가능

## 쿠버네티스의 아키텍처 
![img](https://github.com/koni114/TIL/blob/master/docker/img/docker_01.png)

- <b>클러스터의 관리를 담당하는 마스터</b>와 <b>컨테이너화된 애플리케이션을 실제 실행하는 노드</b> 두 종류로 구성
- 마스터는 kubectl 과 같은 API client로부터 요청을 받아 애플리케이션의 배포, 스케일업/다운, 컨테이너의 버전 업 등의 요구를 처리
- 마스터는 K8s 클러스터의 단일 장애점(Single Point of Failure, SPOF)이 되지 않도록 다중화할 수 있음
- 쿠버네티스에 연결 가능한 노드는 버전 1.11 기준 5000대  
  노드를 추가하고 제거하는 작업은 애플리케이션이 돌아가는 도중에도 실시 가능


## 샘플 코드 다운로드 경로
- `https://github.com/Jpub/15_DandK`
- `git clone https://github.com/Jpub/15_Dandk`
 
## 용어 정리
- 프로비저닝(provisioning)  
  - 사용자의 요구에 맞게 시스템 자원을 할당, 배치, 배포해 두었다가 필요 시 시스템을 즉시 사용할 수 있는 상태로 미리 준비해두는 것을 말함
- CI/CD(Continuous Integration/Continuous Delivery)
  - S/W 개발시 테스트 단계에서만 테스트 하는 것이 아니라 일상적으로 빌드와 테스트를 수행하여 실제 동작을 확인하는 사이클을 돌면서 S/W 품질을 관리하는 것
  - CI를 위한 전용 소프트웨어나 SaaS를 이용하여 자동화함
  - CD는 지속적 배포라고 불리며, CI의 범위를 확장하여 통합 테스트를 위한 스테이징 환경에 배포, 정식 서비스 배포까지 자동화 도구를 사용하여 수행하는 것을 말함

