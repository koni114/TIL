# chpater05 네트워크 계층 : 목적지에 데이터 전달하기 
- 네트워크 계층의 역할과 네트워크 간의 연결에 대해 알아보기
- 다른 네트워크에 있는 목적지로 데이터를 전달하려면 네트워크 계층의 기술이 필요
- 데이터 링크 계층에서는 이더넷 규칙을 기반으로 데이터의 전송을 담당하는데, 이 규칙에 따라 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있지만, 인터넷이나 다른 네트워크로는 데이터를 전송할 수 없음
- 즉, 수많은 네트워크가 연결된 환경에서는 데이터 링크 계층의 기능만으로는 다른 네트워크로 데이터를 전송하기 힘듬
![img](https://github.com/koni114/Network/blob/master/img/network_22.JPG)
- <b>네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할</b>
- 이 계층을 통해 다른 네트워크로 데이터를 전송하려면 <b>라우터</b>라는 네트워크 장비가 필요
- 가정에서도 라우터를 설치하면 인터넷에 연결할 수 있고, 멀리 해외로도 데이터를 보낼 수 있음
- 라우터는 데이터의 목적지가 정해지면 <b>해당 목적지까지 어떤 경로로 가면 좋은지를 알려주는 기능</b>을 함
- 네트워크에서는 데이터를 보내려면 반드시 목적지 주소가 있어야 함
- MAC주소는 네트워크 내부에서만 목적지 주소로 사용되며, 네트워크를 식별할 수 있는 <b>IP주소</b>를 사용
- IP 주소는 어떤 네트워크의 어떤 컴퓨터인지를 구분할 수 있도록 해주는 주소
- 원하는 목적지를 IP주소로 지정하면 데이터를 보낼 수 있는데, 목적지 지정뿐만 아니라 데이터를 어떤 경로로 보낼지도 결정해야 함. 이를 결정하는 것을 <b>라우팅</b>이라고 함
- 라우팅은 라우터라는 장비가 함. 레이어 3 스위치라는 장비도 라우팅을 할 수 있음
- 라우터는 다음 그림과 같은 장비임. 이 라우터를 사용하여 거리에 관계없이 다른 네트워크로 데이터를 보낼 수 있음. 또 라우터에는 라우팅 테이블(routing table)이 있어서 경로 정보를 등록하고 관리함
![img](https://github.com/koni114/Network/blob/master/img/network_23.JPG)

## IP란? 
- 네트워크 계층에는 IP(Internet Protocol)이라는 프로토콜이 있음
- 데이터를 다른 네트워크에 있는 목적지까지 보내려면 라우터가 필요하다고 했는데, 이 IP가 있어서 가능함
- 네트워크 계층에서는 캡슐화할 때 아래와 같은 IP 헤더를 붙임
![img](https://github.com/koni114/Network/blob/master/img/network_24.JPG)
- 다 기억할 필요 없이 '출발지 IP 주소'와 '목적지 IP 주소'가 있다는 것은 기억하자
- IP 프로토콜을 사용하여 캡슐화할 때는 데이터에 IP 헤더가 추가되는데, 이렇게 만들어진 것을 <b>IP 패킷</b>이라고 함
- 데이터 링크 계층에서는 프레임, 네트워크 계층에서는 IP패킷임을 기억하자

## IP 주소의 구조
- IP주소는 ISP에게 받을 수 있음. 집에서 인터넷을 하기 위해서는 계약한 통신사가 있는데, 그때 부여 받음
- IP 버전에는 IPv4와 IPv6가 있음
- IPv4의 주소의 부족함 때문에 IPv6를 만듬. 앞으로는 계속 IPv4와 IPv6가 공존해서 사용됨
- IP주소에는 <b>공인 IP 주소</b>와 <b>사설 IP 주소</b>가 있음. 참고로 공인 IP 주소는 인터넷 서비스 제공자(ISP)가 제공함
- 두 종류나 필요한 이유는, 사용할 수 있는 IPv4의 주소가 고갈되고 있기 때문에 인터넷에 직접 연결되는 컴퓨터나 라우터에는 공인 IP 주소를 할당하고, 회사나 가정의 랜에 있는 컴퓨터는 사설 IP 주소를 할당하는 정책을 사용하고 있음
- 예를 들어 랜안에 여러 대의 컴퓨터가 있다면 공인 IP 주소는 사용할 수 있는 숫자가 제한되므로 컴퓨터 한 한 대당 공인 IP 주소를 할당하기 어려움
- ISP가 제공하는 공인 IP 주소는 라우터에만 할당하고, 랜 안에 있는 컴퓨터에는 랜의 네트워크 관리자가 자유롭게 사설 IP 주소를 할당하거나 라우터의 DHCP 기능을 사용하여 주소를 자동으로 할당
![img](https://github.com/koni114/Network/blob/master/img/network_25.JPG)
- 공인 IP 주소와 사설 IP 주소는 2진수 32비트를 동일하게 사용하고 있음
- MAC 주소는 48비트로 구분하기 쉽도록 16진수를 사용하며, IP 주소는 32비트로 구분하기 쉽도록 10진수 사용
- 해당 32비트를 사람이 읽기 쉽게하기 위하여 <b>8비트 단위로 나눠서 10진수</b> 표시함  
  참고로 8비트를 <b>옥텟(octet)</b>이라고 부르기도 함
![img](https://github.com/koni114/Network/blob/master/img/network_26.JPG)
- 실제로 IP 주소는 2진수로 되어 있음을 기억하자!
- 이러한 IP 주소는 <b>네트워크 ID와 호스트 ID</b>로 나눠져 있는데, 네트워크 ID는 어떤 네트워크인지를 나타내고, 호스트ID는 해당 네트워크의 어떤 컴퓨터인지를 나타냄. 이 두가지 정보가 합쳐져셔 IP 주소가 됨

## IP 주소의 클래스 구조
- IP 주소는 네트워크 규모에 따라 A ~ E 클래스로 나눠져 있음
- IPv4의 주소는 32비트. 비트로 구분하지만 네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어 네트워크 크기를 조정할 수 있음. 네트워크 크기는 클래스라는 개념으로 구분하고 있음
- 클래스는 다음 표와 같이 A ~ E로 나누어져 있음
![img](https://github.com/koni114/Network/blob/master/img/network_27.JPG)
- 일반 네트워크에서는 A ~ C 클래스까지 사용 가능
- A 클래스는 처음 8비트가 네트워크 ID이고, 다음 24비트가 호스트 ID
- B 클래스는 처음 16비트가 네트워크 ID이고, 다음 16비트가 호스트 ID
- C 클래스는 처음 24비트가 네트워크 ID이고, 다음 8비트가 호스트 ID
- 각 클래스별 공인 IP 주소의 범위는 다음과 같음
![img](https://github.com/koni114/Network/blob/master/img/network_28.JPG)

## 네트워크 주소와 브로드캐스트 주소
- 추가적인 IP 주소에 대해서 알아보자
- 네트워크 주소와 브로드캐스트 주소는 자신의 IP로 사용하면 안되는 주소
  - 네트워크 주소는 호스트 ID가 10진수로 0인 주소
  - 브로드캐스트 주소는 호스트 ID가 10진수로 마지막 숫자가 255인 주소 
![img](https://github.com/koni114/Network/blob/master/img/network_29.JPG)
- <b>네트워크 주소</b>는 전체 네트워크에서 작은 네트워크를 식별하는데 사용되고, 호스트 ID가 10진수로 0이면 그 네트워크 전체를 대표하는 주소가 됨. 쉽게 말해 전체 네트워크의 대표 주소라고 생각하면 됨
- 예를들어 192.168.1.1 ~ 192.168.1.6의 IP 주소를 가진 컴퓨터는 192.168.1.0(네트워크 주소)의 네트워크에 있다고 할 수 있음
- 브로드캐스트 주소는 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용되는 전용 IP 주소
- 예를들어 192.168.1.255의 브로드캐스트 주소로 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 받게 됨
- <b>중요한 것은 네트워크 주소와 브로드캐스트 주소는 자신의 주소로 할당하면 안됨!</b>

## 서브넷의 구조
- 많은 수의 컴퓨터가 브로드캐스트 패킷을 전송하면 모든 컴퓨터에 패킷이 전송되고 네트워크가 혼잡해짐
- 따라서 대규모 네트워크를 작은 네트워크로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있음  
  이렇게 하면 더 많은 네트워크를 만들 수 있어서 IP 주소를 효과적으로 사용할 수 있음
![img](https://github.com/koni114/Network/blob/master/img/network_30.JPG)
- 이처럼 네트워크를 분할하는 것을 <b>서브넷팅(subneting)</b>이라고 하며, 분할된 네트워크를 서브넷(subnet)이라고 함
- 아래 그림과 같이 A 클래스는 네트워크 ID가 8비트고 호스트 ID가 24비트임. 이 상태를 서브넷팅하여 작은 네트워크로 분할되는 것을 말하는 것. 기존에 네트워크 ID와 호스트 ID로 구성되어 있던 것이 네트워크ID, 서브넷 ID, 호스트 ID로 나눠지게 됨
![img](https://github.com/koni114/Network/blob/master/img/network_31.JPG)

## 서브넷 마스크란?
- IP 주소를 서브세팅하면 어디까지가 네트워크 ID고 어디부터가 호스트 ID인지 판단하기가 어려울 때가 있는데, 그럴 때는 <b>서브넷 마스크</b>라는 값을 사용
- 즉 서브넷 마스크는 네트워크 ID와 호스트 ID를 식별하기 위한 값
- 다음과 같이 32비트의 값으로, A 클래스는 255.0.0.0, B 클래스는 255.255.0.0, C 클래스는 255.255.255.0이 됨
- 프리픽스(prefix) 표기법으로도 사용할 수 있는데, 아래 그림과 같이 서브넷 마스크를 슬래시(/비트 수)로 나타낸 것을 말함. 예를 들어 255.255.255.0은 /24가 됨
![img](https://github.com/koni114/Network/blob/master/img/network_32.JPG)
- C 클래스의 IP 주소를 서브넷팅 해보자
- C 클래스이므로 일반적으로 네트워크 ID가 24비트, 다음과 같이 28비트로 변경하면 4비트를 호스트 ID에서 빌리게 되며, 즉 네트워크ID가 24비트, 서브넷ID 4비트, 호스트ID가 4비트가 됨
![img](https://github.com/koni114/Network/blob/master/img/network_33.JPG)
- 이 네트워크의 서브넷 마스크는 255.255.255.240인데 이것을 프리픽스 표기법으로 바꾸면, /28이됨

## 라우터란? 
- 서로 다른 네트워크와 통신하려면 라우터가 필요. 라우터는 다음 그림과 같이 네트워크를 분리할 수 있음
![img](https://github.com/koni114/Network/blob/master/img/network_34.JPG)
- 허브와 스위치(레이어 2 스위치)는 네트워크 내부에서만 데이터를 주고 받을 수 있음을 꼭 기억하자
- 다음 그림처럼 컴퓨터 1이 컴퓨터 6에 접속한다고 가정할 때, 컴퓨터 1이 다른 네트워크에 데이터를 전송하려면 라우터의 IP 주소를 설정해야 함
- 이것은 네트워크의 출입구를 설정하는 것으로 <b>기본 게이트웨이(default gateway)</b>리고 함
![img](https://github.com/koni114/Network/blob/master/img/network_35.JPG)
- 라우터에 IP 주소를 지정해야 하는 이유는 컴퓨터 1은 다른 네트워크로 데이터를 보낼 때 어디로 전송해야 하는지 알지 못함    
  그래서 네트워크의 출입구를 지정하고 일단은 라우터로 데이터를 전송함
- 여기서 컴퓨터 1은 192.168.1.0/24 네트워크에 속해 있기 때문에 라우터의 IP 주소인 192.168.1.1로 설정함   
- 컴퓨터 1의 기본 게이트웨이가 설정되었지만, 컴퓨터 6에 데이터를 보내려면 라우팅(routing)기능이 필요

## 라우팅이란?
- 라우팅은 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송
- 이 경로 정보가 등록되어 있는 테이블이 <b>라우팅 테이블(routing table)</b>임
- 라우터의 라우팅 테이블에 경로 정보가 등록되어 있어서 라우팅이 가능함. 따라서 컴퓨터 A에서 컴퓨터 B로 데이터를 보낼 수 있음
- 라우팅 테이블 등록은 네트워크 관리자가 수동으로 등록하는 방법과 자동으로 등록하는 방법이 있는데, 수동은 소규모 네트워크에, 자동은 대규모 네트워크에 적합
- 자동으로 등록하는 방법은 라우터 간의 경로 정보를 서로 교환하여 라우팅 테이블 정보를 자동으로 수정해줌
- 이처럼 라우터 간의 라우터 정보를 교환하기 위한 프로토콜을 <b>라우팅 프로토콜</b>이라고 함
- 라우팅 프로토콜을 설정하여 라우터 간의 경로 정보를 서로 교환하고 그것을 라우팅 테이블에 등록해 나가는 것
- 라우팅 프로토콜에는 RIP, OSPF, BGP 등이 있고, 각각 다른 특징이 있음


## 용어 정리
- 레이어 3 스위치
  - 네트워크를 분할하여 라우팅을 할 수 있는 네트워크 장비 
- DHCP
  - Dynamic Host Cofiguration Protocol의 약어로 IP 주소를 할당하는 프로토콜 
- IPv6
  - 155.8비트로 확장하여 거의 무제한의 IP 주소를 할당할 수 있게 됨
  - 이를 통해 에어컨이나 TV에도 인터넷을 연결하여 통신할 수 있게 됨 
- 네트워크 계층
  - 다른 네트워크와 통신하기 위한 경로 설정을 위해 라우터를 통한 라우팅을 하며 패킷 전송을 담당
- IP(Internet protocol)
  - 인터넷에 있는 한 컴퓨터에서 다른 컴퓨터로 데이터를 보내는 데 사용되는 네트워크 계층 프로토콜
- IP 주소
  - 컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신하기 위해 사용하는 주소
- IP 주소 클래스
  - IPv4에서 사용하는 주소 그룹에는 총 5개의 그룹이 있음
  - A, B, C 클래스는 네트워크ID와 호스트ID로 구성되며, D 클래스는 멀티캐스트 주소로 사용됨
  - E 클래스는 필요에 따라 사용하기 위해 확보해 놓은 것
- 라우터
  - 서로 다른 네트워크를 연결해 주는 장치
  - 현재의 네트워크에서 다른 네트워크로 패킷을 전송 할 수 있도록 함
- 라우팅
  - 네트워크에서 패킷을 목적지로 보낼 때 목적지까지 갈 수 있는 여러가지 경로 중 한가지 경로로 설정해주는 과정
- 라우팅 테이블
  - 컴퓨터 네트워크에서 목적지 주소를 목적지에 도달하기 위한 네트워크 노선으로 변화시킬 목적으로 사용됨
  - 다른 네트워크로 가기 위한 가장 좋은 라우터의 정보를 가지고 있음
- 서브넷
  - 큰 네트워크를 분할해서 만든 작은 네트워크
- 서브넷팅
  - 네트워크를 분할하기 위해 IP 주소의 구성을 변경하는 작업
- 서브넷 ID
  - IP 주소의 네트워크 부분을 늘리기 위해 서브넷 마스크로 사용되는 비트로 서브넷 비트라고 함
- 서브넷 마스크
  - IP 주소의 네트워크 부분만 나타나게 하여 같은 네트워크인지 판별하게 하는 마스크
- 멀티케스트
  - 한 컴퓨터에서 패킷을 여러 컴퓨터로 동시에 전송하는 것을 말함
- 브로드캐스트
  - IP 네트워크에 있는 모든 컴퓨터로 데이터를 전송하는 방식             
       