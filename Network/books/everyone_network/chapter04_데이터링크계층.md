# chapter04 데이터 링크 계층: 랜에서 데이터 전송하기
- 랜에서 데이터를 주고 받으려면 데이터 링크 계층의 기술이 필요 

## 이더넷이란? 
- <b>데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층</b>
- 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층
- 일반적으로 가장 많이 사용되는 규칙이 <b>이더넷(Ethernet)임</b>
- 이더넷은 허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고받을 때 사용
- 허브의 특징 중 하나는 송신한 포트를 제외한 모든 포트에 데이터가 전달되도록 되어있는데, 이를 개선하는 방법이 있음
- 보내려는 데이터에 목적지 정보를 추가해서 보내고 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 되어 있음
![img](https://github.com/koni114/Network/blob/master/img/network_13.JPG)
- 허브는 단순히 데이터를 모든 포트에 보내는 역할을 수행하는데, 이때 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수도 있음. 이를 <b>충돌(collision)</b>이라고 함
- 이더넷은 CSMA/CD 방법을 사용해서 절대 충돌나지 않는 구조를 가져감
- CS는 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 확인하는 규칙. MA는 케이블에 데이터가 흐르고 있지 않으면 데이터를 보내도 된다는 규칙. CD는 충돌이 발생하고 있는지 확인하는 규칙
- 최근에는 성능적인 문제 때문에 스위치를 사용

## MAC 주소란?
- 랜카드는 비트열(0과 1)을 전기 신호로 변환하는데, 이러한 랜카드는 <b>MAC주소</b>라는 번호가 정해져 있음
- 제조할 때 새겨지기 때문에 물리 주소라고도 하는데, 전 세계에서 유일한 번호로 할당되어 있음
- 절대 중복되지 않도록 규칙이 명확하게 정해져 있음. MAC 주소는 48비트 숫자로 구성되어 있음  
  앞쪽 24비트는 랜카드를 만든 제조사 번호, 뒤쪽 24비트는 제조사가 랜카드에 붙인 일련번호
- ex) 00-23-AE-D9-7A-9A
- OSI모델이나 TCP/IP 모델에서 각 계층에서 헤더를 붙이는데, OSI 모델에서는 데이터 링크 계층, TCP/IP 모델에서는 네트워크 계층에 해당되는데, 이 계층에서 이더넷 헤더와 트레일러를 붙임
- 이더넷 헤더는 목적지의 MAC 주소(6바이트), 출발지 MAC 주소(6바이트), 유형(2바이트)해서 총 14바이트로 구성
- 이더넷 유형은 이더넷으로 전송되는 상위 계층 프로토콜의 한 종류. <b>유형에는 프로토콜을 식별하는 16진수 번호</b>가 들어감
![img](https://github.com/koni114/Network/blob/master/img/network_15.JPG)
- 데이터 뒤에 들어가는 트레일러를 FCS(Frame Check Sequence)라고도 하는데, 데이터 전송 도중에 오류가 발생하는지 확인 용도로 사용
- 즉 <b>이더넷 헤더와 트레일러가 추가된 데이터를 프레임이라고 함</b>

### 이더넷 헤더를 이용한 통신
- 컴퓨터 1에서 컴퓨터 3으로 데이터를 전송할 떄, 전송 컴퓨터의 MAC 주소와 수싱 컴퓨터의 MAC 주소를 담아 헤더로 붙인 후, 트레일러를 포함한 캡슐화를 통해 데이터를 송신하고, 컴퓨터 2, 4, 5는 해당 데이터를 파기하고 3번은 자신의 MAC 주소와 같기 때문에 물리 계층에서 데이터를 비트열로 변환하고 데이터 링크 계층에서 헤더와 트레일러를 분리하는 역캡슐화 후 데이터를 수신함

## 스위치란? 
- <b>스위치는 데이터 링크 계층에서 동작하고</b> 레이어 2 스위치 또는 스위칭 허브라고도 부름
- 장비 외형은 허브랑 비슷함 
![img](https://github.com/koni114/Network/blob/master/img/network_16.JPG)
- 스위치 내부에는 <b>MAC 주소 테이블</b>이라는 것이 있음. MAC 주소 테이블은 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스
- 스위치 전원을 켠 상태에서는 MAC 주소 테이블에 아무것도 등록되어 있지 않음. 하지만 컴퓨터에서 목적지 MAC 주소가 추가된 프레임이라는 데이터가 전송되면 그림 4-12와 같이 MAC 주소 테이블을 확인하고 출발지 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록. 이를 <b>MAC 주소 학습 기능</b>이라고 함
- 목적지 MAC 주소가 MAC 주소 테이블에 등록되어 있지 않으면 모든 포트에 데이터가 전송되는데, 이를 <b>플러딩</b>이라고 함
- MAC 주소가 등록되어 있으면 목적지 컴퓨터에만 데이터가 전송됨. 이 때 MAC 주소를 기준으로 목적지를 선택하는 것을 <b>MAC 주소 필터링</b>이라고 함

## 전이중 통신과 반이중 통신
- 데이터가 충돌하지 않는 구조에 대해서 알아보자
- 통신 방식에는 전이중 통신 방식과 반이중 통신 방식이 있음. <b>전이중 통신 방식은 데이터의 송수신을 동시에 통신하는 방식이며, 반이중 통신 방식은 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식</b>
- 전이중 통신 방식은 동시에 송수신해도 충돌이 발생하지 않지만, 반이중 통신 방식은 충돌 발생
- 컴퓨터 1,2를 직접 랜 케이블로 연결한다면, 선을 4쌍 이용하기 때문에 전이중 통신 방식이 됨 
![img](https://github.com/koni114/Network/blob/master/img/network_17.JPG)
- 반면 허브 내부에서는 송수신이 나누어져 있지 않기 때문에 회선 하나를 송신과 수신이 번갈아가면서 일어나는 반이중 통신 방식이 사용됨
![img](https://github.com/koni114/Network/blob/master/img/network_18.JPG)
- 스위치는 아래 그림과 같이 충돌이 일어나지 않는 구조로 되어 있기 때문에 전이중 통신 방식으로도 데이터를 주고 받을 수 있음
![img](https://github.com/koni114/Network/blob/master/img/network_19.JPG)
- <b>허브를 사용하면 충돌이 생기면서 네트워크 지연이 발생하기 때문에 최근에는 스위치를 사용하는 것이 표준</b>
- 충돌의 영향이 미치는 범위를 충돌 도메인(collision domain)이라고 함
- 아래 그림과 같이 허브는 연결되어 있는 컴퓨터 전체가 충돌 도메인이 됨
![img](https://github.com/koni114/Network/blob/master/img/network_20.JPG)
- 스위치는 전이중 통신 방식이기 때문에 충돌 도메인의 영역이 각각의 컴퓨터에 해당됨
- 즉 충돌 도메인의 범위가 늘어날수록 네트워크 지연 현상이 발생할 수 있음

## 이더넷 규격
- 케이블 종류나 통신 속도에 따라 다양한 규격으로 분류됨
- 다음은 이더넷의 대표적인 규격을 정리해놓은 표
![img](https://github.com/koni114/Network/blob/master/img/network_21.JPG)
- 10BASE-T를 대표로 설명해보면, [10:통신속도, BASE:전송방식, T:케이블]  
  10은 10Mbps라는 뜻(통신 속도), BASE는 BASEBAND라는 전송 방식을 나타내며, T는 케이블 종류
- 하이픈(-) 뒤에는 케이블 길이나 케이블 종류를 나타냄. 동축 케이블은 케이블의 최대 길이를 100M 단위로 표시 
  예를 들어 10BASE5는 케이블의 최대 길이가 500m이므로 5로 표시
- 10BASE-T는 UTP 케이블을 말함    
- 최근 컴퓨터의 랜 포트는 1000BASE-T가 일반적임. 조금씩 10GBASE-T도 많아지고 있음

## 용어 정리
- MAC 주소
  - Media Access Control Address(물리 주소)의 약어
  - 랜에서 사용되는 네트워크 모델인 이더넷의 물리적인 주소로 컴퓨터의 각 기기를 구분하기 위해 사용하는 주소
- MAC 주소 테이블
  - 브리지 테이블(bridge table)이라고도 하며, 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되어 있는 데이터베이스
- 데이터 링크 계층
  - 네트워크 기기 간의 데이터를 전송하고 물리 주소를 결정
- 이더넷
  - 컴퓨터 네트워크 기술 중 하나로, 랜에서 가장 많이 활용되는 기술 규격(프로토콜)
- 스위치
  - 랜을 구성할 때 사용하는 단말기 간 스위칭 기능이 있는 통신망 중계 장치
  - 컴퓨터(호스트)에서 특정한 다른 단말기로 패킷을 보낼 수 있는 기능이 있음
- ARP(Address Resolution Protocol, 주소 변환 프로토콜)
  - 네트워크 계층 주소와 데이터 링크 계층 주소 사이의 변환을 담당하는 프로토콜
  - IP 주소를 물리 주소인 MAC 주소로 변환하는 데 사용
- ARP 캐시(ARP Cache)
  - 가장 최근에 변환한 IP 대 하드웨어 주소를 보관하고 있는 RAM의 한 영역
- ARP 요청(ARP Request)
  - IP 주소를 대치할 수 있는 물리 주소인 MAC 주소를 찾아내기 위해 보내는 브로드캐스트 패킷 요청
- ARP 응답(ARP reply)
  - ARP 요청에 대한 응답으로, 요청한 IP 주소에 대한 물리 주소인 MAC 주소가 실려 있음     
