# chapter08 네트워크 전체 흐름 살펴보기
- 다음은 OSI 모델에 각 계층의 역할을 나타낸 그림
![img](https://github.com/koni114/Network/blob/master/img/network_52.JPG)
- 예를 들어 다음과 같이 컴퓨터, 스위치, 라우터, 웹 서버로 구성된 네트워크가 있다고 가정할 때, 이 구성은 몇 개의 네트워크로 나누어져 있을끼? 
![img](https://github.com/koni114/Network/blob/master/img/network_53.JPG)
- 192.168.1.0/24, 172.16.0.0/16, 192.168.10.0/24로 총 3개
- 위의 그림을 OSI 모델로 나타내면 다음과 같음
![img](https://github.com/koni114/Network/blob/master/img/network_54.JPG)

## 컴퓨터의 데이터가 전기 신호로 변환되는 과정
- OSI 모델의 전체적인 관점으로 데이터가 전달되고 처리되는 과정을 살펴보자
- 구체적으로 컴퓨터의 웹 브라우저에 URL를 입력할 때부터 웹 서버에 도착할 때까지 이루어지는 OSI 모델의 캡슐화와 역캡슐화를 살펴보자
- <b>다음의 컴퓨터의 캡슐화 과정을 꼭 기억하자!</b>
![img](https://github.com/koni114/Network/blob/master/img/network_55.JPG)
- 먼저 웹 사이트에 접속해야 하므로, 응용 계층에서부터 시작함
- 웹 브라우저에 URL을 입력하고 enter키를 누르면 캡슐화가 시작됨
- 단 3-way 헨드셰이크는 이미 완료되어 연결이 확립되어 있다고 가정하자
- 응용 계층에서는 웹 서버에 있는 html 데이터를 얻어야 하므로, 'GET / index.html HTTP/1.1 ~'과 같은 HTTP 메세지를 보냄(데이터에 해당)
- http의 GET은 데이터를 보내 달라는 의미임
- 계속해서 이 데이터가 전송 계층에 전달되는데, TCP 헤더가 붙음. 전송 계층의 TCP 헤더에서 출발지 포트 번호와 목적지 포트 번호가 필요함. 이 때 출발지 포트 번호는 무작위로 선택되며, 도착치 포트 번호는 웹 서버의 80번 포트로 데이터를 전송
- 이 때 TCP 헤더를 가진 데이터를 <b>세그먼트</b>라고 함
- 그 다음에는 데이터가 네트워크 계층에 전달됨. 이 네트워크 계층에서는 IP 헤더가 붙는데, 출발지 IP 주소와 도착치 IP 주소를 붙이며 IP 헤더와 데이터가 붙은 데이터를 <b>IP 패킷</b>이라고 함  
- 그 다음에는 데이터 링크 계층으로 전달되며, 이더넷 헤더가 추가됨
- 이더넷 헤더가 추가된 데이터를 <b>이더넷 프레임</b>이라고 부름
- 그다음으로 물리 계층에서 랜 카드에 의해 전기 신호로 변환되어 네트워크로 전송됨

## 스위치와 라우터에서의 데이터 전달과 처리
- 스위치와 라우터에서 데이터가 처리되는 과정을 알아보자
- 스위치 A는 데이터 링크 계층에서 데이터를 전기 신호로 변환하여 라우터 A로 전송
![img](https://github.com/koni114/Network/blob/master/img/network_56.JPG)
- 계속해서 데이터는 스위치 A에서 라우터 A로 전기 신호를 전달
- 스위치 A에서 전기신호로 변환되어 케이블을 통해 라우터 A로 도착하면, 라우터 A는 데이터링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC주소를 비교함
- 이떄 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행
- 다음으로 네트워크 계층으로 전달하고 자신의 라우팅 테이블과 목적지 IP주소를 비교
![img](https://github.com/koni114/Network/blob/master/img/network_57.JPG)
- 라우터 A의 라우팅 테이블에서 목적지 IP 주소의 경로를 알 수 있으므로, 라우팅 가능
- 그래서 현재 출발지 IP 주소 192.168.1.10을 라우터의 외부 IP 주소(실제로는 WAN 측)인 172.16.0.1로 변경
- 그런 다음 데이터 링크 계층으로 전달하여 라우터 B로 보내지도록 이더넷 헤더와 트레일러를 붙인 후에 물리 계층에서 데이터를 전기신호로 변환하여 네트워크로 전달
![img](https://github.com/koni114/Network/blob/master/img/network_58.JPG)
- 그다음 데이터는 전기 신호 형태로 라우터 A에서 라우터 B로 전달됨
- 마찬가지로 라우터 B에서는 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교
- 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행하고, 그다음 네트워크 계층으로 전달되면 자신의 라우팅 테이블과 목적지 IP 주소를 비교
- 라우터 B의 라우팅 테이블을 확인해보면 목적지 IP 주소의 경로를 알 수 있으므로, 라우팅 가능
- 현재 출발지 IP 주소 172.16.0.1을 내부 IP 주소 192.168.10.1로 변경
- 그 다음 데이터 링크 계층으로 전달하여 스위치에 전달되도록 이더넷 헤더와 트레일러를 붙인 후 물리 계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달
- 전기 신호의 형태의 데이터가 라우터 B에서 스위치 B로 전달. 스위치 B는 전기 신호를 데이터링크 계층에서 처리하고 웹 서버에 데이터를 전기 신호로 전달

## 웹 서버에서의 데이터 전달과 처리
- 데이터가 전기 신호로 웹 서버에 도착하면, 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교
- 주소가 같으면 이더넷 헤더와 트레일러를 분리하고 네트워크 계층에 전달
- 네트워크 계층에서는 목적지 IP 주소와 웹 서버의 IP 주소가 같은지 확인. 주소가 같으면 IP 헤더를 분리하고 전송 계층에 전달
- 전송 계층에서는 목적지 포트 번호를 확인하여 어떤 애플리케이션으로 전달해야 하는지 판단하고, TCP 헤더를 분리하여 응용 계층에 전달

## 정적 라우팅과 동적 라우팅
- 정적 라우팅은 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가하는 방법
- 동적 라우팅은 네트워크 변경을 자동으로 감지하여 라우팅 테이블을 업데이트하거나 네트워크 장애가 발생했을 때 라우터끼리 정보를 교환하여 최적으로 경로로 전환하는 기능을 함