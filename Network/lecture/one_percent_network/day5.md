## chatper03 - 케이블의 앞은 LAN 기기였다 - 허브와 스위치, 라우터의 탐험
- 케이블에 송출한 패킷이 리피터 허브, 스위칭 허브, 라우터 등의 네트워크 기기를 경유하여 인터넷을 향해 진행하는 부분 

### 케이블과 리피터, 허브 속을 신호가 흘러간다
#### 하나하나의 패킷이 독립된 것으로 동작한다
- 컴퓨터에서 송신된 패킷은 허브나 라우터라는 중계 장치에 의해 중계되어 목적지를 향해 진행
- 패킷의 헤더에 기록된 제어 정보와 중계 장치 내부에 있는 중계 대상을 등록한 표로 목적지를 판단하고 목적지에 가까워지도록 하여 패킷을 중계한다는 형태
- 내용을 보지 않으므로, 애플리케이션의 데이터나 TCP 프로토콜 제어 정보의 내용이 패킷을 운반하는 동작에 영향을 주지 않음
- 이번 장에서는 클라이언트 PC가 송신한 패킷이 리피터 허브 -> 스위칭 허브 -> 라우터를 경유하여 인터넷에 나가는 것으로 간주

#### LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다
![img](https://github.com/koni114/TIL/blob/master/Network/lecture/one_percent_network/img/network_15.png)
![img](https://github.com/koni114/TIL/blob/master/Network/lecture/one_percent_network/img/network_16.png)

- LAN 어댑터의 PHY(MAU) 회로에서 전기 신호로 형태를 바꾼 패킷은 RJ-45 커넥터를 통해 <b>트위스트 페어 케이블(꼰 선쌍)</b> 에 들어감
- 이더넷의 신호의 실체는 플러스와 마이너스의 전압이므로 LAN 어댑터의 PHY(MAU) 회로의 플러스와 마이너스 신호 단자에서 신호가 나온다고 생각하면 됨
- LAN 어댑터의 PHY(MAU) 회로는 커넥터의 1번, 2번 핀에서 케이블로 신호가 흘러나감
- 신호는 케이블 속을 흘러 리피터 허브의 커넥터 부분에 도착
- 송출한 신호는 허브에 도착시 신호가 약해져있으며, 케이블의 길이가 더 길어질수록 신호가 약해짐

![img](https://github.com/koni114/TIL/blob/master/Network/lecture/one_percent_network/img/network_17.png)

- 위의 그림처럼 사각형의 각진 신호를 사용하지만, 이 각이 뭉개져서 둥글게 됨
- 이 현상은 주파수가 높을수록 에너지가 떨어지는 비율이 높다는 전기 신호의 성질과 관계가 있음
- 약해진 신호가 변형되면 0과 1을 잘못 판독할 수 있는데, 이는 통신 오류의 원인이 됨

#### '꼼'은 잡음을 방지하기 위한 방법이다
- LAN 케이블로 사용하는 트위스트 페어 케이블(꼰 선쌍)은 잡음의 영향을 억제하는 대책이 마련되어 있는데, 이것이 '꼼'임
- 잡음의 원인은 주변에서 생기는 전자파임  
  이 때문에 케이블의 주위에 전자파가 있으면 신호와는 다른 전류가 케이블 안에 흐름
- 케이블에 영향을 주는 전자파는 크게 2가지
  - 모터, 형광등, 모니터 등에서 누설되는 전자파(외부에서 발생)
  - 케이블 안의 인접한 신호선에서 누설되는 전자파
- 이 두가지를 선을 꼼으로서 막을 수 있음

#### 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다
- 신호가 리피터 허브에 도착하면 LAN 전체에 신호가 흩어짐
- 이더넷의 기본이라는 원리, 즉 전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷을 수신한다는 원리를 그대로 실현한 것이 리피터 허브임
- 리피터 허브의 커넥터 안쪽에는 LAN 어댑터의 내부에 있는 PHY(MAU) 회로와 역할이 같은 회로가 있음
- 제대로 수신하려면 송신 단자에서 보낸 신호를 수신 단자가 받도록 해야하며, 이 때문에 허브 안의 PHY 회로와 커넥터 사이의 신호선을 교차시킴
- 리피터 허브의 끝의 커넥터에는 MDI/MDI-X와 같이 쓰여있는 전환 스위치가 붙어있음
- MDI로 전환하는 스위치가 없고 모든 커넥터가 MDI-X인 경우에는 크로스 케이블로 허브들을 접속
- 리피터 회로의 기본은 신호를 그대로 뿌리는 것이므로 잡음의 영향을 받아 변형되고, 데이터가 변화한 것 같은 신호라도 그대로 흘려버림

#### 스위칭 허브는 주소 테이블로 중계한다
- 스위칭 허브(=스위치)는 이더넷의 패킷을 그대로 목적지를 향해(특정 port) 중계하도록 만들어져 있음

![img](https://github.com/koni114/TIL/blob/master/Network/lecture/one_percent_network/img/network_18.png)

- 스위칭 허브 송수신 프로세스 
  - 신호가 들어옴 
  - PHY(MAU) 회로 수신 부분으로 들어감 
  - MAC 회로 
  - 버퍼 메모리 저장
  - MAC 주소표 조사하여 송신할 MAC 주소 조사
  - 스위치 회로를 경유하여 송신측의 포트로 보냄
  - MAC 회로 -> PHY(MAU) -> 송신 
- 커넥터와 안쪽에 있는 스위치 회로 부분을 포트라고 부르므로, 스위칭 허브의 각 포트는 PC 의 LAN 어댑터와 거의 같음
- LAN 어댑터와 달리 스위칭 허브의 포트에는 MAC 주소가 할당되어 있지 않고, MAC 주소표를 통해 송신할 MAC 주소를 확인

#### MAC 주소 테이블을 등록 및 갱신한다
- 스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행
- 하나의 방법은 페킷을 수신했을 때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록하는 것
- 사용하지 않고 일정시간이 경과한 경우는 MAC 주소표에서 삭제
- 예외 경우
  - 주소표에 등록된 수신 포트와 송신 포트가 동일할 때는 폐기  
    ex) 리피터 허브에서 브로드캐스팅을 통해 스위칭 허브에 송신되고, 다시 스위칭 허브에서 리피터 허브로 송신되는 경우
  - 수신처 MAC 주소와 일치하는 주소가 등록되어 있지 않은 경우, 수신받은 포트 이외에 모든 포트에 전송
  - 수신처 MAC 주소가 브로드캐스트 주소인 경우에도 수신 포트를 제외하고 모든 포트에서 패킷을 송신

#### 전이중 모드에서 송신과 수신을 동시에 실행한다
![img](https://github.com/koni114/TIL/blob/master/Network/lecture/one_percent_network/img/network_19.png)

- 전이중 모드는 송신과 수신을 동시에 실행할 수 있는 성질인데, 이는 리피터 허브에는 없고 스위치 허브에만 있는 특징
- 스위칭 허브의 포트 부분, PHY 회로, MAC 회로의 내부도 송신과 수신이 나뉘어져 있어 신호가 따로 흐르기 때문에 충돌하지 않음
- 신호의 충돌을 검사하는 회로를 무효화하기로 한 것이 전이중 동작 모드 

#### 최적의 전송 속도로 보내는 자동 조정
- 자동 조정(auto negotiation)은 접속한 상대가 전이중 모드를 지원하는지 검출하고 동작 모드를 자동으로 전환하는 기능
- 동작 모드뿐만 아니라 상대의 전송 속도를 검출하여 전송 속도도 자동으로 전환됨
- 데이터가 흐르고 있지 않을 때 링크 펄스를 통해 조정 가능 여부를 상대방에게 보내서 자동 조정

#### 스위칭 허브는 복수의 중계 동작을 동시에 실행한다
- 스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로 다른 포트는 빈상태가 됨
- 이렇게 해서 동시에 여러 패킷을 중계할 수 있음

