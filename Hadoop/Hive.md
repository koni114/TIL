## Apache Hive
### Apache Hive란?
- 아파치 하이브는 복잡한 mapreduce 코드를 사용자가 쉽게 사용할 수 있는 SQL과 유사한 HiveQL로 처리가 가능하도록 하는 서비스
- HDFS에 저장된 데이터에 catalog와 metastore를 제공하여 논리적 데이터 베이스, 테이블, 파티션을 제공하여 데이터를 구조화할 수 있게 함

### 하이브의 탄생배경
- 하이브는 페이스북에서 개발이 시작되어, 넷플릭스와 같은 다른 기업도 기여함
- 2000년대 초, 하둡이 탄생하여 데이터 분석은 DB기반에서 하둡 환경을 기반으로 진행되기 시작함
- 하둡은 기존의 데이터베이스가 가지고 있던 한계를 넘는 기능들을 제공해주었지만 복잡한 맵리듀스 코드를 작성해야 하며, 테이블과 같은 논리적인 개념이 없어서 파일 단위 또는 디렉토리 단위로 데이터를 관리함
- 하이브는 이러한 하둡 환경에서 데이터 웨어하우징과 같은 SQL 기반 접근을 통한 데이터 처리와 데이터베이스, 테이블, 파티션과 같은 논리적 레벨의 카탈로그 및 메타스토어를 제공함

### 하이브 아키텍처
- 하이브의 아키텍처는 아래 이미지와 같이 접근포인트들(CLI, Hive Server, Web UI), 드라이버, 컴파일러, 메타스토어로 구성됨

![img](https://github.com/koni114/TIL/blob/master/Hadoop/img/hive.PNG)

- <b>접근 포인트</b>: CLI, Hive Server, Web UI와 같은 접근 포인트들은 외부 사용자가 하이브에 쿼리를 제출할 수 있는 사용자 인터페이스를 제공함
- <b>드라이버</b>: hive query를 받고 라이프사이클을 관리하는 컨트롤러 역할을 담당. 세션 실행 시작, 라이프 사이클 모니터링, 쿼리문 실행시에 메타데이터를 저장, 리듀스 실행 이후의 결과물을 수집 등
  - executor : 컴파일과 최적화 이후에 엑서큐터는 tasks를 실행함. 실행 엔진과 연동하여 의존성을 가진 작업이 순차적으로 실행되도록 관리
- <b>컴파일러</b>: 하이브 쿼리의 컴파일을 담당하여 실행플랜으로 변환
- <b>메타스토어</b> : 각 테이블의 스키마, 위치와 같은 메타데이터를 관리. data abstraction과 data discovery 를 제공. 파티션 메타데이터 쿼리를 통해 Thrift 인터페이스를 제공

### 데이터 모델
- 하이브에서 데이터는 아래와 같은 주요 객체를 통해 구조화됨: 데이터베이스, 테이블, 파티션, 버킷, 뷰, 데이터타입들
- 데이터베이스: 테이블의 그룹
- 테이블 : RDBMS의 테이블에 상응하는 객체. 각 테이블은 HDFS 디렉토리를 가짐(모든 데이터가 subpath에 존재하지 않을 수 있음). 테이블 안에 있는 데이터는 직렬화되어 저장됨
- 파티션 : 각 테이블들은 여러 개의 파티션을 가질 수 있음. 이러한 파티션은 테이블 하위의 데이터의 분배와 위치를 결정하게 됨. 파티션은 Data Scan을 줄여 쿼리를 최적화하는데 큰 역할을 함
- 버킷(Bucket) : 각 파티션에 존재하는 데이터는 한 컬럼에 들어있는 값의 해쉬를 통해 버킷으로 나눠질 수 있음
- 뷰(View) : 논리적인 데이터 구조로 쿼리의 복잡함을 줄여 간단하게 만드는 기능을 함. 여기서 논리적인 이유는 어떤 데이터를 추가하지 않고 오로지 메타스토어에만 저장을 하기 때문  
RDBMS의 뷰와는 달리, HQL의 뷰는 어떤 데이터도 저장하지 않고 materialized되지 않음  
뷰가 참조하는 테이블의 변경은 뷰 스키마에 반영되지 않음. 그렇기 떄문에 테이블이 삭제되거나 변경되고 뷰에 접근하면 뷰에 접근 시점에 실패가 발생하게 됨